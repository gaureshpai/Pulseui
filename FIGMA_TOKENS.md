# Figma Tokens: Architecture, Pipeline, and Schema (PulseUI)

This document describes the end‑to‑end token pipeline from Figma to code, the naming rules used by the sync, and the canonical token schema enforced in the repo. Treat this file as the source of truth for token integration.

## Pipeline overview

1. Figma variables → fetch

- The script `scripts/sync-figma-tokens.js` reads Figma variables via `FIGMA_API_TOKEN` and `FIGMA_FILE_KEY`.

2. Normalize → categorize

- Variable names are normalized to lowercase, non‑alphanumerics become hyphens, and grouped into categories based on Figma collection/type.

3. Persist → compare

- Current tokens are extracted from `src/styles/_tokens.scss`.
- Figma tokens are processed and compared; changes are merged.

4. Write outputs

- `tokens/tokens.json`: current tokens snapshot for the repo.
- `tokens/figma-tokens.json`: Figma‑sourced snapshot for reference.
- `src/styles/_tokens.scss`: CSS variables are updated in place.

5. Generate themes for runtime

- `scripts/generate-themes.js` reads `_tokens.scss` and writes `src/styles/themes.ts` with `defaultLightTheme`, `defaultDarkTheme`, and `themes` map.

Commands

- Sync from Figma: `npm run sync-tokens`
- Generate themes: `npm run generate-themes`

Important

- Do not manually override design tokens. All changes must flow from Figma through the sync to keep design system compliance.
- Consume tokens through the theme context or the generated CSS variables; prefer theme context from tokens CSS when available.

## Naming rules (Figma → CSS variables)

Convention

- Figma path `Group / Sub-Group / Name` becomes `--group-sub-group-name`.
- Names are lowercased; spaces and symbols become `-`.

Examples

- `Spacing / xs` → `--spacing-xs`
- `Color / Text / Primary` → `--color-text-primary`
- `Typography / Size / H1` → `--typography-size-h1`

Additional handling by sync

- Color variables are converted to `#rrggbb` or `rgba(r,g,b,a)` depending on opacity.
- FLOAT values become pixel strings (e.g., `8px`).
- STRING values (e.g., font families) are kept as‑is.

## Token categories (canonical)

The repo defines the canonical JSON schema at `src/styles/token-schema.json`. Key categories align with how the sync and theme generator work:

- Colors: semantic and scales

  - Semantic: `primary`, `secondary`, `success`, `warning`, `error`, `info`, `surface`, `text`, `border`, `background`, `white`, `black`, `gray`
  - Scales: numeric `0`…`9` for each color family (e.g., `blue-0 … blue-9`).

- Spacing: `xs, sm, md, lg, xl, xxl, 2xl` → pixel/rem/em strings

- Typography

  - Sizes: `font-size-xs … font-size-xxl`
  - Line heights: `line-height-xs … line-height-xxl`
  - Weights: `font-weight-normal|medium|semibold|bold`
  - Family: `font-family`

- Effects

  - Shadows: `shadow-sm|md|lg|xl`
  - Radii: `radius-sm|md|lg|xl`

- Sizes: `xs, sm, md, lg, xl, xxl`

- Breakpoints: `mobile, tablet, desktop, wide` (px strings)

Required in schema

- At top level: `brand` metadata and `tokens` with at least a `light` theme.
- Within a theme: `colors`, `spacing`, `typography`, `effects` are required; others are optional but recommended.

## Generated theme artifacts

- `src/styles/themes.ts` exports:
  - `defaultLightTheme`, `defaultDarkTheme` (dark generated by scale inversion + overrides for background/surface/text/border)
  - `themes` map: `{ "default-light": ..., "default-dark": ... }`

## Practical guidance for Figma setup

- Organize variables into clear collections: Color, Spacing, Typography, Size, Effects.
- Use numeric scales `0 … 9` for color families; keep semantic colors separate.
- Prefer opacity in color variables only when truly needed; otherwise use solid hex.
- Keep typography consistent: sizes as numbers (FLOAT), family as STRING.

## Examples (Figma → CSS)

- `Color / Primary / 6` → `--color-primary-6: #228be6;`
- `Color / Text / Primary` → `--color-text-primary: #212529;`
- `Spacing / md` → `--spacing-md: 16px;`
- `Typography / Font Family` → `--typography-font-family: Inter, sans-serif;`

## File map (what changes where)

- Inputs from Figma: variables API
- Repo outputs:
  - `tokens/figma-tokens.json` and `tokens/tokens.json`
  - `src/styles/_tokens.scss` (authoritative CSS variables consumed by the lib)
  - `src/styles/themes.ts` (runtime theme objects)

## Compliance

- No manual overrides of design tokens in the codebase.
- Prefer theme context from tokens CSS for runtime consumption.
- Run `npm run sync-tokens` after design changes in Figma, then `npm run generate-themes`.

For detailed validation rules, see `src/styles/token-schema.json`.
